{"version":3,"sources":["webpack://waiter/webpack/universalModuleDefinition","webpack://waiter/external \"Shiny\"","webpack://waiter/external \"jQuery\"","webpack://waiter/webpack/bootstrap","webpack://waiter/webpack/runtime/define property getters","webpack://waiter/webpack/runtime/hasOwnProperty shorthand","webpack://waiter/webpack/runtime/make namespace object","webpack://waiter/./srcjs/exts/dimensions.js","webpack://waiter/./srcjs/exts/waiter.js"],"names":["root","factory","exports","module","require","define","amd","self","__WEBPACK_EXTERNAL_MODULE__541__","__WEBPACK_EXTERNAL_MODULE__609__","__webpack_module_cache__","__webpack_require__","moduleId","cachedModule","undefined","__webpack_modules__","d","definition","key","o","Object","defineProperty","enumerable","get","obj","prop","prototype","hasOwnProperty","call","r","Symbol","toStringTag","value","getDimensions","element","width","offsetWidth","height","offsetHeight","top","isNaN","offsetTop","left","offsetLeft","waiterToHideOnRender","Map","waiterToFadeout","waiterToHideOnError","waiterToHideOnSilentError","setWaiterHiddenInput","id","input","Shiny","setInputValue","priority","defaultWaiter","html","color","hideOnRender","hideOnError","hideOnSilentError","image","fadeOut","onShown","showWaiter","params","dom","selector","exists","document","querySelector","console","log","set","el","window","innerHeight","$","getComputedStyle","position","className","childNodes","forEach","hideRecalculate","overlay","createElement","overlayContent","innerHTML","classList","add","style","backgroundColor","backgroundImage","appendChild","err","message","hideWaiter","onHidden","find","length","timeout","setTimeout","remove","updateWaiter","getElementsByClassName","hiddenRecalculating","css","head","getElementsByTagName","styleSheet","cssText","createTextNode","showRecalculate","on","event","waiterToHide","name","error","type","addEventListener","waiters","fs","waiter","dim","parentElement","innerWidth","addCustomMessageHandler","opts","hide_on_render","hide_on_error","hide_on_silent_error","fade_out"],"mappings":"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","file":"waiter.js","sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory(require(\"Shiny\"), require(\"jQuery\"));\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine([\"Shiny\", \"jQuery\"], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"waiter\"] = factory(require(\"Shiny\"), require(\"jQuery\"));\n\telse\n\t\troot[\"waiter\"] = factory(root[\"Shiny\"], root[\"jQuery\"]);\n})(self, function(__WEBPACK_EXTERNAL_MODULE__541__, __WEBPACK_EXTERNAL_MODULE__609__) {\nreturn ","module.exports = __WEBPACK_EXTERNAL_MODULE__541__;","module.exports = __WEBPACK_EXTERNAL_MODULE__609__;","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId](module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","// define __esModule on exports\n__webpack_require__.r = (exports) => {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","export const getDimensions = (element) => {\n  var elementPosition = {\n\t\twidth: element.offsetWidth,\n\t\theight: element.offsetHeight,\n\t\ttop: isNaN(element.offsetTop) ? 0 : element.offsetTop,\n\t\tleft: isNaN(element.offsetLeft) ? 0 : element.offsetLeft,\n\t};\n\n  return elementPosition;\n}","import 'shiny';\nimport 'jquery';\nimport { getDimensions } from './dimensions';\n\n// elements to hide on recomputed\nvar waiterToHideOnRender = new Map();\nvar waiterToFadeout = new Map();\nvar waiterToHideOnError = new Map();\nvar waiterToHideOnSilentError = new Map();\n\nconst setWaiterShownInput = (id) => {\n  let input = \"waiter_shown\";\n  if(id !== null)\n    input = id + \"_\" + input;\n  \n  Shiny.setInputValue(input, true, {priority: 'event'});\n};\n\nconst setWaiterHiddenInput = (id) => {\n  let input = \"waiter_hidden\";\n  if(id !== null)\n    input = id + \"_\" + input;\n  \n  Shiny.setInputValue(input, true, {priority: 'event'});\n}\n\nlet defaultWaiter = {\n  id: null, \n  html: '<div class=\"container--box\"><div class=\"boxxy\"><div class=\"spinner spinner--1\"></div></div></div>', \n  color: '#333e48', \n  hideOnRender: false, \n  hideOnError: false, \n  hideOnSilentError: false, \n  image: null,\n  fadeOut: false,\n  onShown: setWaiterShownInput\n};\n\n// show waiter overlay\nexport const showWaiter = (params = defaultWaiter) => {\n\n  // declare\n  var dom,\n      selector = 'body',\n      exists = false;\n\n  // get parent\n  if(params.id !== null)\n    selector = '#' + params.id;\n  \n  dom = document.querySelector(selector);\n  if(dom == undefined){\n    console.log(\"Cannot find\", params.id);\n    return ;\n  }\n  \n  // allow missing for testing\n  params.hideOnRender = params.hideOnRender || false;\n\n  // set in maps\n  waiterToHideOnRender.set(params.id, params.hideOnError);\n  waiterToFadeout.set(selector, params.fadeOut);\n  waiterToHideOnError.set(params.id, params.hideOnError);\n  waiterToHideOnSilentError.set(params.id, params.hideOnSilentError);\n\n  let el = getDimensions(dom); // get dimensions\n\n  // no id = fll screen\n  if(params.id === null){\n    el.height = window.innerHeight;\n    el.width = $(\"body\").width();\n  }\n  \n  // force static if position relative\n  // otherwise overlay is completely off\n  var pos = window.getComputedStyle(dom, null).position;\n  if(pos == 'relative')\n    dom.className += ' staticParent';\n\n  // check if overlay exists\n  dom.childNodes.forEach(function(el){\n    if(el.className === 'waiter-overlay')\n      exists = true;\n  });\n\n  if(exists){\n    console.log(\"waiter on\", params.id, \"already exists\");\n    return;\n  }\n  \n  hideRecalculate(params.id);\n\n  // create overlay\n  let overlay = document.createElement(\"DIV\");\n  // create overlay content\n  let overlayContent = document.createElement(\"DIV\");\n  // insert html\n  overlayContent.innerHTML = params.html;\n  overlayContent.classList.add(\"waiter-overlay-content\");\n\n  // dynamic position\n  if(params.id == null)\n    overlay.style.position = \"fixed\";\n  else\n    overlay.style.position = \"absolute\";\n  \n  // dynamic dimensions\n  overlay.style.height = el.height + 'px';\n  overlay.style.width = el.width + 'px';\n  overlay.style.top = el.top + 'px';\n  overlay.style.left = el.left + 'px';\n  overlay.style.backgroundColor = params.color;\n  overlay.classList.add(\"waiter-overlay\");\n\n  if(params.image != null && params.image != ''){\n    overlay.style.backgroundImage = \"url('\" + params.image + \"')\";\n  }\n\n  // either full-screen or partial\n  if(params.id !== null) {\n    overlay.classList.add(\"waiter-local\");\n  } else {\n    overlay.classList.add('waiter-fullscreen');\n  }\n\n  // append overlay content in overlay\n  overlay.appendChild(overlayContent);\n\n  // append overlay to dom\n  dom.appendChild(overlay);\n\n  // set input\n  try {\n    params.onShown(params.id);\n  }\n  catch(err) {\n    console.log(\"likely using waiterShowOnLoad - shiny not connected yet:\", err.message);\n  }\n  \n}\n\nexport const hideWaiter = (id, onHidden) => {\n\n  var selector = 'body';\n  if(id !== null)\n    selector = '#' + id;\n\n  let overlay = $(selector).find(\".waiter-overlay\");\n  \n  if(overlay.length == 0)\n    return;\n  \n  let timeout = 250;\n  if(waiterToFadeout.get(selector)){\n    let value = waiterToFadeout.get(selector);\n\n    if(typeof value == 'boolean')\n      value = 500;\n\n    $(overlay).fadeOut(value);\n\n    timeout = timeout + value;\n  }\n  \n  // this is to avoid the waiter screen from flashing\n  setTimeout(function(){\n    overlay.remove();\n  }, timeout);\n\n  onHidden(id);\n\n}\n\nexport const updateWaiter = (id, html) => {\n\n  var selector = 'body';\n  if(id !== null)\n    selector = '#' + id;\n\n  var dom = document.querySelector(selector);\n\n  var overlay = dom.getElementsByClassName(\"waiter-overlay-content\");\n  \n  if(overlay.length == 0)\n    return;\n\n  if(overlay.length > 0)\n    overlay[0].innerHTML = html;\n  else\n    console.log(\"no waiter on\", id);\n  \n}\n\n// storage to avoid multiple CSS injections\nlet hiddenRecalculating = new Map();\n\nconst hideRecalculate = (id) => {\n\n  if(id === null)\n    return ;\n  \n  if(hiddenRecalculating.get(id))\n    return;\n  \n  hiddenRecalculating.set(id, true);\n\n  var css = '#' + id + '.recalculating {opacity: 1.0 !important; }',\n      head = document.head || document.getElementsByTagName('head')[0],\n      style = document.createElement('style');\n\n  style.id = id + \"-waiter-recalculating\";\n  if (style.styleSheet){\n    style.styleSheet.cssText = css;\n  } else {\n    style.appendChild(document.createTextNode(css));\n  }\n\n  head.appendChild(style);\n}\n\n// currently unused but may be useful for others using JS API\nexport const showRecalculate = (id) => {\n  $(id + \"-waiter-recalculating\").remove();\n}\n\n// remove when output receives value\n$(document).on('shiny:value', function(event) {\n  if(waiterToHide.get(event.name)){\n    hideWaiter(event.name);\n  }\n});\n\n// remove when output errors\n$(document).on('shiny:error', function(event) {\n  if(event.error.type == null && waiterToHideOnError.get(event.name)){\n    hideWaiter(event.name);\n    return\n  } \n  \n  if (event.error.type != null && waiterToHideOnSilentError.get(event.name)){\n    hideWaiter(event.name);\n  }\n});\n\n// On resize we need to resize the waiter screens too\nwindow.addEventListener(\"resize\", function(){\n  let waiters = document.getElementsByClassName(\"waiter-local\");\n  let fs = document.getElementsByClassName(\"waiter-fullscreen\");\n\n  for(waiter of waiters){\n    let dim = getDimensions(waiter.parentElement);\n    waiter.style.width = dim.width + 'px';\n    waiter.style.height = dim.height + 'px';\n  }\n\n  for(waiter of fs){\n    waiter.style.width = window.innerWidth + 'px';\n    waiter.style.height = window.innerHeight + 'px';\n  }\n});\n\nShiny.addCustomMessageHandler('waiter-show', function(opts) {\n  showWaiter({\n    id: opts.id, \n    html: opts.html, \n    color: opts.color, \n    hideOnRender: opts.hide_on_render,\n    hideOnError: opts.hide_on_error, \n    hideOnSilentError: opts.hide_on_silent_error,\n    image: opts.image,\n    fadeOut: opts.fade_out\n  });\n  Shiny.setInputValue(\"waiter_shown\", true, {priority: 'event'});\n});\n\nShiny.addCustomMessageHandler('waiter-update', function(opts) {\n  updateWaiter(opts.id, opts.html);\n});\n\nShiny.addCustomMessageHandler('waiter-hide', function(opts) {\n  hideWaiter(opts.id, setWaiterHiddenInput);\n});\n"],"sourceRoot":""}