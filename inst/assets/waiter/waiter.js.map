{"version":3,"sources":["webpack://waiter/webpack/universalModuleDefinition","webpack://waiter/external \"Shiny\"","webpack://waiter/external \"jQuery\"","webpack://waiter/webpack/bootstrap","webpack://waiter/webpack/runtime/compat get default export","webpack://waiter/webpack/runtime/define property getters","webpack://waiter/webpack/runtime/hasOwnProperty shorthand","webpack://waiter/webpack/runtime/make namespace object","webpack://waiter/./srcjs/exts/waiter.js"],"names":["root","factory","exports","module","require","define","amd","self","__WEBPACK_EXTERNAL_MODULE__541__","__WEBPACK_EXTERNAL_MODULE__609__","__webpack_module_cache__","__webpack_require__","moduleId","cachedModule","undefined","__webpack_modules__","n","getter","__esModule","d","a","definition","key","o","Object","defineProperty","enumerable","get","obj","prop","prototype","hasOwnProperty","call","r","Symbol","toStringTag","value","waiter_to_hide","Map","waiter_to_fadeout","waiter_to_hide_on_error","waiter_to_hide_on_silent_error","showWaiter","id","html","color","to_hide","hide_on_error","hide_on_silent_error","image","fade_out","console","error","dom","selector","exists","document","querySelector","log","set","el","width","element","offsetWidth","height","offsetHeight","top","isNaN","offsetTop","left","offsetLeft","window","innerHeight","$","getComputedStyle","position","className","childNodes","forEach","hideRecalculate","overlay","createElement","overlay_content","innerHTML","classList","add","style","backgroundColor","backgroundImage","appendChild","Shiny","setInputValue","priority","err","message","hideWaiter","find","length","timeout","fadeOut","setTimeout","remove","updateWaiter","getElementsByClassName","hiddenRecalculating","css","head","getElementsByTagName","styleSheet","cssText","createTextNode","showRecalculate","on","event","name","type","addEventListener","waiters","fs","waiter","dim","get_offset","parentElement","innerWidth","addCustomMessageHandler","opts","hide_on_render","input"],"mappings":"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","file":"waiter.js","sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory(require(\"Shiny\"), require(\"jQuery\"));\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine([\"Shiny\", \"jQuery\"], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"waiter\"] = factory(require(\"Shiny\"), require(\"jQuery\"));\n\telse\n\t\troot[\"waiter\"] = factory(root[\"Shiny\"], root[\"jQuery\"]);\n})(self, function(__WEBPACK_EXTERNAL_MODULE__541__, __WEBPACK_EXTERNAL_MODULE__609__) {\nreturn ","module.exports = __WEBPACK_EXTERNAL_MODULE__541__;","module.exports = __WEBPACK_EXTERNAL_MODULE__609__;","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId](module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","// getDefaultExport function for compatibility with non-harmony modules\n__webpack_require__.n = (module) => {\n\tvar getter = module && module.__esModule ?\n\t\t() => (module['default']) :\n\t\t() => (module);\n\t__webpack_require__.d(getter, { a: getter });\n\treturn getter;\n};","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","// define __esModule on exports\n__webpack_require__.r = (exports) => {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","import 'shiny';\nimport 'jquery';\n\n// compute offset position of waiter overlay\nconst getDimensions = (element) => {\n  var elementPosition = {\n\t\twidth: element.offsetWidth,\n\t\theight: element.offsetHeight,\n\t\ttop: isNaN(element.offsetTop) ? 0 : element.offsetTop,\n\t\tleft: isNaN(element.offsetLeft) ? 0 : element.offsetLeft,\n\t};\n\n  return elementPosition;\n}\n\n// elements to hide on recomputed\nvar waiter_to_hide = new Map();\nvar waiter_to_fadeout = new Map();\nvar waiter_to_hide_on_error = new Map();\nvar waiter_to_hide_on_silent_error = new Map();\n\n// show waiter overlay\nexport const showWaiter = (\n  id = null, \n  html, \n  color = '#333e48', \n  to_hide = false, \n  hide_on_error = false, \n  hide_on_silent_error = false, \n  image = null,\n  fade_out = false\n) => {\n\n  if(html == null){\n    console.error(\"Missing html content\");\n    return;\n  }\n\n  // declare\n  var dom,\n      selector = 'body',\n      exists = false;\n\n  // get parent\n  if(id !== null)\n    selector = '#' + id;\n  \n  dom = document.querySelector(selector);\n  if(dom == undefined){\n    console.log(\"Cannot find\", id);\n    return ;\n  }\n  \n  // allow missing for testing\n  to_hide = to_hide || false;\n\n  // set in maps\n  waiter_to_hide.set(id, to_hide);\n  waiter_to_fadeout.set(selector, fade_out);\n  waiter_to_hide_on_error.set(id, hide_on_error);\n  waiter_to_hide_on_silent_error.set(id, hide_on_silent_error);\n\n  let el = getDimensions(dom); // get dimensions\n\n  if(id === null){\n    el.height = window.innerHeight;\n    el.width = $(\"body\").width();\n  }\n  \n  // force static if position relative\n  // otherwise overlay is completely off\n  var pos = window.getComputedStyle(dom, null).position;\n  if(pos == 'relative')\n    dom.className += ' staticParent';\n\n  // check if overlay exists\n  dom.childNodes.forEach(function(el){\n    if(el.className === 'waiter-overlay')\n      exists = true;\n  });\n\n  if(exists === true){\n    console.log(\"waiter on\", id, \"already exists\");\n    return;\n  }\n  \n  hideRecalculate(id);\n\n  // create overlay\n  var overlay = document.createElement(\"DIV\");\n  // create overlay content\n  var overlay_content = document.createElement(\"DIV\");\n  // insert html\n  overlay_content.innerHTML = html;\n  overlay_content.classList.add(\"waiter-overlay-content\");\n\n  // dynamic position\n  if(id == null)\n    overlay.style.position = \"fixed\";\n  else\n    overlay.style.position = \"absolute\";\n  \n  // dynamic dimensions\n  overlay.style.height = el.height + 'px';\n  overlay.style.width = el.width + 'px';\n  overlay.style.top = el.top + 'px';\n  overlay.style.left = el.left + 'px';\n  overlay.style.backgroundColor = color;\n  overlay.classList.add(\"waiter-overlay\");\n\n  if(image != null && image != ''){\n    overlay.style.backgroundImage = \"url('\" + image + \"')\";\n  }\n\n  if(id !== null) {\n    overlay.classList.add(\"waiter-local\");\n  } else {\n    overlay.classList.add('waiter-fullscreen');\n  }\n  //overlay.style.animation = \"expand .15s ease-in-out\";\n\n  // append overlay content in overlay\n  overlay.appendChild(overlay_content);\n\n  // append overlay to dom\n  dom.appendChild(overlay);\n\n  // set input\n  try {\n    Shiny.setInputValue(id + \"_waiter_shown\", true, {priority: 'event'});\n  }\n  catch(err) {\n    console.log(\"waiterShowOnLoad - shiny not connected yet:\", err.message);\n  }\n  \n}\n\nexport const hideWaiter = (id) => {\n\n  var selector = 'body';\n  if(id !== null)\n    selector = '#' + id;\n\n  let overlay = $(selector).find(\".waiter-overlay\");\n  \n  if(overlay.length == 0)\n    return;\n  \n  let timeout = 250;\n  if(waiter_to_fadeout.get(selector)){\n    let value = waiter_to_fadeout.get(selector);\n\n    if(typeof value == 'boolean')\n      value = 500;\n\n    $(overlay).fadeOut(value);\n\n    timeout = timeout + value;\n  }\n  \n  // this is to avoid the waiter screen from flashing\n  setTimeout(function(){\n    overlay.remove();\n  }, timeout);\n\n}\n\nexport const updateWaiter = (id, html) => {\n\n  var selector = 'body';\n\n  if(id !== null)\n    selector = '#' + id;\n\n  var dom = document.querySelector(selector);\n\n  var overlay = dom.getElementsByClassName(\"waiter-overlay-content\");\n  \n  if(overlay.length == 0)\n    return;\n\n  if(overlay.length > 0)\n    overlay[0].innerHTML = html;\n  else\n    console.log(\"no waiter on\", id);\n  \n}\n\n// storage to avoid multiple CSS injections\nlet hiddenRecalculating = new Map();\n\nconst hideRecalculate = (id) => {\n\n  if(id === null)\n    return ;\n  \n  if(hiddenRecalculating.get(id))\n    return;\n  \n  hiddenRecalculating.set(id, true);\n\n  var css = '#' + id + '.recalculating {opacity: 1.0 !important; }',\n      head = document.head || document.getElementsByTagName('head')[0],\n      style = document.createElement('style');\n\n  style.id = id + \"-waiter-recalculating\";\n  if (style.styleSheet){\n    style.styleSheet.cssText = css;\n  } else {\n    style.appendChild(document.createTextNode(css));\n  }\n\n  head.appendChild(style);\n}\n\n// currently unused but may be useful for others using JS API\nexport const showRecalculate = (id) => {\n  $(id + \"-waiter-recalculating\").remove();\n}\n\n// remove when output receives value\n$(document).on('shiny:value', function(event) {\n  if(waiter_to_hide.get(event.name)){\n    hideWaiter(event.name);\n  }\n});\n\n// remove when output errors\n$(document).on('shiny:error', function(event) {\n  if(event.error.type == null && waiter_to_hide_on_error.get(event.name)){\n    hideWaiter(event.name);\n  } else if (event.error.type != null && waiter_to_hide_on_silent_error.get(event.name)){\n    hideWaiter(event.name);\n  }\n});\n\n// On resize we need to resize the waiter screens too\nwindow.addEventListener(\"resize\", function(){\n  let waiters = document.getElementsByClassName(\"waiter-local\");\n  let fs = document.getElementsByClassName(\"waiter-fullscreen\");\n\n  for(waiter of waiters){\n    dim = get_offset(waiter.parentElement);\n    waiter.style.width = dim.width + 'px';\n    waiter.style.height = dim.height + 'px';\n  }\n\n  for(waiter of fs){\n    dim = get_offset(waiter.parentElement);\n    waiter.style.width = window.innerWidth + 'px';\n    waiter.style.height = window.innerHeight + 'px';\n  }\n});\n\nShiny.addCustomMessageHandler('waiter-show', function(opts) {\n  showWaiter(\n    opts.id, \n    opts.html, \n    opts.color, \n    opts.hide_on_render, \n    opts.hide_on_error, \n    opts.hide_on_silent_error,\n    opts.image,\n    opts.fade_out\n  );\n  Shiny.setInputValue(\"waiter_shown\", true, {priority: 'event'});\n});\n\nShiny.addCustomMessageHandler('waiter-update', function(opts) {\n  updateWaiter(opts.id, opts.html);\n});\n\nShiny.addCustomMessageHandler('waiter-hide', function(opts) {\n  hideWaiter(opts.id);\n\n  let input = \"waiter_hidden\";\n  if(opts.id !== null)\n    input = opts.id + \"_\" + input;\n  \n  Shiny.setInputValue(input, true, {priority: 'event'});\n});\n"],"sourceRoot":""}